# 建模手to编程手 第1问 交付文档

# 2. 模型假设

**假设1：** 假设所有板与板之间、板与把手之间，均不存在任何摩擦，可以自由运动。

**假设2：** 由题目可知，我们假设所有把手的中心均位于题目所给出的阿基米德螺线上，始终不发生偏移。

**假设3：** 假设水面为完全静止且不存在任何静水恢复力等任何流体力学相关作用，每一把手的运动状态完全由龙头及前面所有把手的运动状态决定。

## 模型参数设定

**固定参数：**

- 总板凳数 N=223
- 龙头板长 LEN_HEAD=3.41m
- 龙身与龙尾板长 LEN=2.2m
- 所有板凳的宽度 WIDTH=0.3m
- 龙头把手的间距 FIRST_INTERVAL=LEN_HEAD-2*0.275=2.86m
- 把手间距 HANDLE_INTERVAL=LEN-2*0.275=1.65m
- 龙头前进速度 V_HEAD=1m/s
- 龙头初始位置 POSITION_HEAD=2$\pi$*16=32$\pi$
- 阿基米德螺线方程的螺距 p=0.55m

**需要求解的参数：**

- t时刻下第i个把手的位置 POSITION_I_T (i=1,2,3,...,223,224) (t=0,1,2,3,...,299,300)
- t时刻下第i个把手的总速度大小 V_I_T (i=1,2,3,...,223,224) (t=0,1,2,3,...,299,300)

## 3. 模型计算流程

### 总体思想： 由于龙头的速度与运动状态是固定的，因此可以先求出龙头的位置与速度，再通过位置与速度递推式分别递推求出后续把手的位置与速度。

#### **步骤1：确定盘入螺线的方程**

由题可以确定盘入螺线为阿基米德螺线，其方程为![alt text](image-5.png)
其中在该题里，a=初始状态极角为0下的半径=0，b=$\frac{p}{2\pi}=\frac{0.55}{2\pi}m$，**所以我们的螺线方程为**

**$r(t)=b\theta=\frac{0.55}{2\pi} *\theta(t)$**

**由极坐标转换为直角坐标的方法：**

**$x(t)=r(t) cos\theta(t)=b\theta(t) cos\theta(t) , y(t)=r(t) sin\theta(t)=b\theta(t) sin\theta(t)$**

也就是说，把手在不同时刻的坐标只与把手在不同时刻的极角有关，因此我们只需要求出把手在不同时刻的极角值即可。

#### **步骤2：确定龙头把手的运动方式**

首先明确龙头把手的运动应该是沿着螺线以1m/s的速度向内盘入的,也就是说，我们要想确定龙头把手在每一秒中的位置，就需要确定，龙头在螺线弧长上每运动1m，其极角$\theta(t)$变化为多少，进而由螺线方程求出对应的r(t)，并由极坐标转换为直角坐标求得直角坐标系下的坐标；

龙头把手的初始极坐标为$(r(0),\theta(0))=(8.8m,32\pi)$，由弧长的微分公式

$ds=\sqrt{(dr)^2+(rd\theta)^2}=\sqrt{(\frac{dr}{d\theta})^2\cdot d\theta ^2+r^2(d\theta)^2}=\sqrt{(\frac{dr}{d\theta})^2+r^2} \ d\theta=\sqrt{b^2+b^2 \theta^2}d\theta =b\sqrt{1+\theta ^2}d\theta  $

我们可以对其进行积分，以得到弧长变化量$\Delta s$与极角变化量$\Delta \theta $之间的关系；

具体来讲，我们要求的具体极角$\theta(t)$中t的取值为以1为间隔的整数值，而在$\Delta t=1$的情况下，我们对两侧同时积分得

$\int_{t}^{t+1}ds=b\int_{t}^{t+1}\sqrt{1+\theta(t)^2}d\theta(t)\to 1=b\int_{\theta(t+1)}^{\theta(t)}\sqrt{1+\phi^2}\ d\phi$  (换元法将$\theta\to\phi $)

进一步我们利用三角换元，能够得到

$b\int_{\theta(t+1)}^{\theta(t)}\sqrt{1+\phi^2}\ d\phi=b[F(\theta(t))-F(\theta(t+1))]=\frac{b}{2}\cdot [\theta(t)\sqrt{1+\theta(t)^2}-\theta(t+1)\sqrt{1+\theta(t+1)^2}+ln(\theta(t)+\sqrt{1+\theta(t)^2})-ln(\theta(t+1)+\sqrt{1+\theta(t+1)^2})]$

因此由上述推导，我们能够得到，对于任意的t时刻与1秒之后的t+1时刻，一定存在如下关系式：

**$S(\theta(t))-S(\theta(t+1))=1$,其中$S(x)=\frac{b}{2}\cdot[ x\sqrt{1+x^2}+ln(x+\sqrt{1+x^2})]$**

这也就意味着，只要我们已知$\theta(t)$，就一定可以通过该式反推出$\theta(t+1)$,进而递推出龙头把手在对应任意t时刻的直角坐标系下坐标$x(t),y(t)$

而由于该递推式内存在着无法分离的x，是一个超越方程，因此只能采取数值求解方法，比如牛顿迭代法等。

#### **步骤3：位置坐标的递推方程**

当我们用步骤2中的方法求解出龙头把手在各时刻的位置坐标之后，我们就可以利用相邻板凳之间的递推关系推导出下一个板凳的位置坐标。

具体来讲：我们将板凳视作刚性的，那么板凳就应该呈现出只有把手节点在螺线上，并且相邻把手节点之间还存在着欧氏距离的约束，即相邻把手的欧氏距离应该等于板凳两个节点之间的长度，如图所示：

![alt text](image-7.png)

##### 核心物理约束

任意时刻 $t$，第 $i$ 个把手 $P_i$ 的坐标 $(x_i, y_i)$ 与其前一个把手 $P_{i-1}$ 的坐标 $(x_{i-1}, y_{i-1})$ 之间的欧几里得距离（直线距离）恒等于板凳的有效长度 $L_i$。其数学表达式为：

$$
\sqrt{(x_i(t) - x_{i-1}(t))^2 + (y_i(t) - y_{i-1}(t))^2} = L_i
$$

##### 位置递推方程

我们将螺线的参数方程代入上述约束条件，并对等式两侧同时平方。在求解t时刻第 $i$ 个把手的位置时，$(x_{i-1}(t), y_{i-1}(t))$ 是已知的，而未知的只有角度 $\theta_i(t)$。因此，我们需要求解的通用递推方程是：

$$
\left(b\theta_i(t)\cos(\theta_i(t)) - x_{i-1}(t)\right)^2 + \left(b\theta_i(t)\sin(\theta_i(t)) - y_{i-1}(t)\right)^2 = L_i^2
$$

其中：

- $L_1 = 2.86 \text{ m}$
- $L_i = 1.65 \text{ m}$ (对于 $i \geq 2$)

##### 计算流程 (对任意时刻 t)

在任意一个确定的时刻 $t$（此时龙头的位置已算完），我们按顺序执行以下计算：

1. **求解第一个龙身把手 ($P_1$) 的角度 $\theta_1(t)$**

   * 已知 $(x_0(t), y_0(t))$ 和 $L_1 = 2.86\text{m}$。
   * 通过数值方法求解方程：
     $$
     \theta_1(t)\cos(\theta_1(t)) - x_0(t))^2 + (b\theta_1(t)\sin(\theta_1(t)) - y_0(t))^2 = 2.86^2
     $$
2. **循环递推 (i = 2 to 223)**

   * 建立一个从 $i=2$ 到 $223$ 的循环。在循环的每一步，我们已知前一个把手的位置 $(x_{i-1}(t), y_{i-1}(t))$ 和板凳长度 $L_i=1.65\text{m}$。
   * 通过数值方法求解关于 $\theta_i(t)$ 的方程：
     $$
     \theta_i(t)\cos(\theta_i(t)) - x_{i-1}(t))^2 + (b\theta_i(t)\sin(\theta_i(t)) - y_{i-1}(t))^2 = 1.65^2
     $$
3. **计算坐标**

   * 每当数值求解器找到了一个满足方程的 $\theta_i(t)$，我们就可以立刻用它计算出第 $i$ 个把手的坐标 $(x_i(t), y_i(t))$，以供下一步递推使用。

因此，由以上的递推关系，我们最终可以求出所有把手节点在各时刻的坐标信息，接下来解决各把手之间的速度递推关系；

#### **步骤4：各把手的速度递推方程**

由题目我们易得龙头把手的速度恒定为沿着螺线切线方向的1m/s，显然题目要求其他节点的速度也都是沿着螺线切线方向上的速度，那么由速度分解方法，我们能够得到相邻把手节点沿螺线切线方向速度的递推式，其几何图解为：
![alt text](image-8.png)

推导的基石是“板凳为刚体”这一物理原理。这个原理在速度上的体现是：**相连的两个把手 ($P_{i-1}$ 和 $P_i$)，它们各自的速度向量，在沿着板凳方向 ($P_{i-1}$ 指向 $P_i$) 上的投影（分量）必须相等。**

如果这两个速度分量不相等，就意味着板凳在被拉伸或者被压缩，这与“刚体”的假设相违背。

用向量的语言来描述这个原理就是：

$$
\vec{v}_{i} \cdot \vec{u}_{L_i} = \vec{v}_{i-1} \cdot \vec{u}_{L_i}
$$

其中：

- $\vec{v}_{i-1}$ 和 $\vec{v}_{i}$ 分别是把手 $P_{i-1}$ 和 $P_i$ 的速度向量。
- $\vec{u}_{L_i}$ 是从 $P_{i-1}$ 指向 $P_i$ 的**单位向量**，代表了板凳的方向。

为了使用上述原理，我们需要对公式中的各个向量进行精确的数学定义。在任意时刻 $t$：

**a. 速度向量 $\vec{v}_k$**

- **方向**：根据题目假设，每个把手的运动轨迹都在螺线上，因此其速度方向必然是该点在螺线上的**切线方向**。
- **大小**：速度的大小（速率）$v_k$ 是我们需要求解的未知量。
- **表达式**：

  $$
  ec{v}_k = v_k \cdot \vec{T}(\theta_k)
  $$

  这里的 $\vec{T}(\theta_k)$ 是螺线在角度为 $\theta_k$ 处的**单位切向量**。它的计算方法如下：- 螺线的位置向量：$\vec{r}(\theta) = (b\theta\cos\theta, b\theta\sin\theta)$

  - 对 $\theta$求导得到切向量：$\frac{d\vec{r}}{d\theta} = (b(\cos\theta - \theta\sin\theta), b(\sin\theta + \theta\cos\theta))$
  - 切向量的模长：$|\frac{d\vec{r}}{d\theta}| = \sqrt{(b(\cos\theta - \theta\sin\theta))^2 + (b(\sin\theta + \theta\cos\theta))^2} = b\sqrt{1+\theta^2}$
  - **单位切向量**：
    $$
    ec{T}(\theta) = \frac{d\vec{r}/d\theta}{|d\vec{r}/d\theta|} = \frac{(\cos\theta - \theta\sin\theta, \sin\theta + \theta\cos\theta)}{\sqrt{1+\theta^2}}
    $$

**b. 板凳单位向量 $\vec{u}_{L_i}$**

- **方向**：从前一个把手 $P_{i-1}$ 指向后一个把手 $P_i$。
- **表达式**：在时刻 $t$，我们已经从步骤3中计算出了所有把手的位置 $(x_k(t), y_k(t))$。
  - 板凳向量：$\vec{L_i} = P_i - P_{i-1} = (x_i(t) - x_{i-1}(t), y_i(t) - y_{i-1}(t))$
  - **板凳单位向量**：

    $$
    ec{u}_{L_i} = \frac{\vec{L_i}}{|\vec{L_i}|} = \frac{(x_i(t) - x_{i-1}(t), y_i(t) - y_{i-1}(t))}{L_i}
    $$

    (其中 $L_i$ 是板凳的有效长度，$2.86\text{m}$ 或 $1.65\text{m}$)

现在，我们将这些精确的向量表达式代入核心物理原理 $\vec{v}_{i} \cdot \vec{u}_{L_i} = \vec{v}_{i-1} \cdot \vec{u}_{L_i}$ 中。

$$
(v_i \cdot \vec{T}(\theta_i)) \cdot \vec{u}_{L_i} = (v_{i-1} \cdot \vec{T}(\theta_{i-1})) \cdot \vec{u}_{L_i}
$$

由于速度大小 $v_i$ 和 $v_{i-1}$ 是标量，可以从点积运算中提出：

$$
v_i \left( \vec{T}(\theta_i) \cdot \vec{u}_{L_i} \right) = v_{i-1} \left( \vec{T}(\theta_{i-1}) \cdot \vec{u}_{L_i} \right)
$$

这是一个关于未知量 $v_i$ 的简单线性方程。直接解出 $v_i$，我们就得到了最终的**速度大小递推公式**：

$$
v_i = v_{i-1} \frac{\vec{T}(\theta_{i-1}) \cdot \vec{u}_{L_i}}{\vec{T}(\theta_i) \cdot \vec{u}_{L_i}}
$$

在任意一个确定的时刻 $t$，当所有把手的位置（即所有 $\theta_k(t)$ 和 $(x_k(t), y_k(t))$）都通过步骤3计算完毕后，我们按顺序执行以下速度计算：

1. **初始化**：

   - 龙头 $P_0$ 的速度大小已知：$v_0 = 1.0 \text{ m/s}$。
   - 计算其速度向量：$\vec{v}_0(t) = 1.0 \cdot \vec{T}(\theta_0(t))$。
2. **循环递推 (i = 1 to 223)**：

   - 建立一个从 $i=1$ 到 $223$ 的循环，依次求解 $P_1$ 到 $P_{223}$ 的速度。
   - 在循环的第 $i$ 步：
     - **计算向量**：此时 $v_{i-1}$，$\theta_{i-1}(t)$，$\theta_i(t)$，$x_{i-1}(t)$，$y_{i-1}(t)$，$x_i(t)$，$y_i(t)$ 均为已知量。因此，单位切向量 $\vec{T}(\theta_{i-1})$、$\vec{T}(\theta_i)$ 和板凳单位向量 $\vec{u}_{L_i}$ 都可以被计算出来。
     - **计算点积**：计算递推公式中分子和分母的点积值（即两个向量的内积）。
     - **计算速度大小**：使用递推公式计算出当前把手的速度大小 $v_i$。
     - **计算速度向量**：计算出当前把手的速度向量 $\vec{v}_i(t) = v_i \cdot \vec{T}(\theta_i(t))$。
     - **存储结果**：保存 $v_i$ 和 $\vec{v}_i(t)$。
3. **完成**：循环结束后，我们就得到了该时刻 $t$ 所有224个把手的速度大小和速度向量。

## 模型求解方法需求

对于数值计算的部分，请尽可能使用numba库进行计算加速。

求解方法可以考虑牛顿迭代法或是其他的更高效的数值求解方法。
