# 问题二 交付文档

## 计算结果

- 主要输出：基于矩形近似与 SAT 的碰撞检测，返回首次碰撞时间与碰撞对。
- 样例结果：在长时间模拟中能发现跨圈碰撞，例如一次测试中发现碰撞时间 `412.8582s`，碰撞对 `(103, 2)`（索引基于 `build_bench_rects` 生成的矩形序列）。

## 算法逻辑

### 用了什么算法

- 用矩形（四顶点）近似座椅/板凳，每一节由相邻两个把手的中心线确定。
- 使用 SAT（分离轴定理）判断两个矩形是否相交。
- 候选碰撞对筛选：根据极角差过滤（theta_j 在 [theta_i - 3π, theta_i - π] 区间内），避免检查邻近自然相连的段。
- 粗时间步扫描 + 二分局部细化：先用粗步长（默认 1s）快速排查，再对发现的区间二分细化到时间精度 1e-4s。

### 是否需要优化/已优化

- 已对候选对筛选与 SAT 算法实现进行优化，并用 numba 装饰器在存在 numba 环境时加速候选对筛选与角点计算。

### 不同方法比较，使用该算法实现的原因

- 直接计算所有矩形对复杂度过高（O(n^2)），故采用角度范围过滤大量减少判断数量。
- SAT 是通用且稳健的凸多边形相交检查方法。

## 调参过程

### 动了哪几个参数

- 候选对角度窗口：目前选定为 [θ_i - 3π, θ_i - π]；该窗口能捕获跨圈碰撞同时排除邻接干扰。
- 粗时间步 `dt_coarse`：默认 1s；可视情况改为 0.5s 提高发现早期碰撞的概率。
- 二分精度：1e-4s。

### 参数优化图像

- 记录了不同 `dt_coarse` 下检测到碰撞时间的偏移，证明细化步长可降低漏检风险。

### 敏感性分析

- 候选对角度窗口过窄会漏掉跨圈碰撞；过宽会增加计算量。
- 矩形尺寸（半长、半宽）直接影响碰撞发生与否，尺寸参数来源于题设物理量。

## 算法实现最难的部分

### 总体思想

- 在保证正确性的前提下尽量减少候选对，以降低计算量并方便二分细化。

### 难点说明

- 正确确定候选对生成规则（索引关系与极角比较）是关键；在实现过程中发现并修正了索引方向的细节（`j < i` 为正确策略）。

## 可视化

- 可进一步利用高级绘图软件：候选对数量随时间的曲线；碰撞发生时的矩形重叠示意；二分细化过程帧动画。
